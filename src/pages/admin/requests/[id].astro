---
import Header from "@/src/core/components/Header.astro";
import Layout from "@/src/core/Layout.astro";
import { databases } from "@/src/lib/appwrite";

const { id } = Astro.params;

let client;
try {
  client = await databases.getDocument(
    import.meta.env.PUBLIC_APPWRITE_DB,
    import.meta.env.PUBLIC_APPWRITE_REQUESTS,
    id as string
  );
} catch (error) {
  return Astro.redirect("/admin/requests");
}
---

<Layout title="Detalles de Solicitud">
  <Header />
  <main class="container mx-auto px-4 py-8 max-w-3xl">
    <div class="bg-white shadow-sm rounded-lg p-8">
      <div class="text-center mb-8">
        <div
          class="w-20 h-20 bg-gray-100 rounded-full mx-auto mb-4 flex items-center justify-center"
        >
          <i class="fas fa-user text-gray-400 text-2xl"></i>
        </div>
        <h1 class="text-2xl font-semibold text-gray-900">
          {client.name}
          {client.lastname}
        </h1>
        <p class="text-gray-500 mt-1">{client.email}</p>
      </div>

      <div class="space-y-6">
        <div class="border-t border-gray-200 pt-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">
            Información de Contacto
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-500">Teléfono</p>
              <p class="text-gray-900">{client.phone || "No disponible"}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Fecha de Solicitud</p>
              <p class="text-gray-900">
                {new Date(client.$createdAt).toLocaleDateString()}
              </p>
            </div>
          </div>
        </div>

        <div class="border-t border-gray-200 pt-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">
            Detalles de la Solicitud
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-500">Estado</p>
              <p class="text-gray-900">{client.state}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Municipio</p>
              <p class="text-gray-900">{client.township}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Plan</p>
              <p class="text-gray-900">{client.plan}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Modalidad</p>
              <p class="text-gray-900">{client.mode}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Tipo de Contacto</p>
              <p class="text-gray-900">{client.contact_type}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Información de Contacto</p>
              <p class="text-gray-900">{client.contact_info}</p>
            </div>
          </div>
        </div>

        <div class="border-t border-gray-200 pt-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">
            Estado de la Solicitud
          </h2>
          <div
            class="inline-flex items-center px-3 py-1 rounded-full text-sm"
            class:list={["bg-gray-100 text-gray-800"]}
          >
            {client.status || "Pendiente"}
          </div>
        </div>
      </div>

      <div class="mt-8 flex gap-4 justify-center">
        <a
          href="/admin/requests"
          class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
        >
          <i class="fas fa-arrow-left mr-2"></i>
          Volver a Solicitudes
        </a>
        <a
          href={`/admin/requests/approve/${id}`}
          class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
        >
          <i class="fas fa-check mr-2"></i>
          Aprobar Solicitud
        </a>
      </div>
    </div>
  </main>
</Layout>
